# CModellHDC

C implementation of a Hyperdimensional Computing (HDC) pipeline for EMG classification, with support for:

- `mode 0`: classic sample-wise encoding
- `mode 1`: rolling 5-sample block encoding

The project includes scripts for memory-vector generation, parameter sweeps, and plotting/summary of results.

## Repository Layout

### Root

- `Makefile`: build, sweep, plotting, and cleanup targets.
- `hdc_model.exe`: compiled binary (generated by `build`).
- `.vscode/`: editor workspace settings.
- `.DS_Store`: macOS metadata file (not used by the project).

### C source (`src/`)

- `main.c`: CLI entry point, training/testing flow, mode selection.
- `hdc_types.c`: global HDC parameters (`D`, `M`) and HV allocation helpers.
- `hdc_memory.c`: allocates IM/CM/AM and loads bit-vector memory files.
- `hdc_encode.c`: feature and sample encoding into hypervectors.
- `hdc_train.c`: class prototype training (majority bundling).
- `hdc_classify.c`: nearest class by Hamming distance.
- `hdc_features.c`: CSV loaders for features and labels.
- `hdc_utils.c`: bit ops, XOR, copy, rotation, Hamming distance.
- `block_accumulator.c`: rolling block accumulator for mode 1.

### Headers (`include/`)

- `hdc_types.h`: core types/constants (`N=32`, `NUM_CLASSES=5`), extern `D`/`M`.
- `hdc_memory.h`: IM/CM/AM declarations and load/alloc APIs.
- `hdc_encode.h`: encoding APIs.
- `hdc_train.h`: class training API.
- `hdc_classify.h`: classification API.
- `hdc_features.h`: CSV loading APIs and feature dimension (`FEATURE_DIM=32`).
- `hdc_utils.h`: vector utility APIs.
- `block_accumulator.h`: rolling-window API (`BLOCK_WINDOW=5`).

### Data (`datasets/`)

- `training_emg.csv`: training features (32 columns, header + 4340 samples).
- `training_labels.csv`: training labels (header + 4340 samples).
- `testing_emg.csv`: test features (32 columns, header + 870 samples).
- `testing_labels.csv`: test labels (header + 870 samples).

### Memory vectors (`memoryfiles/`)

- `position-vectors.txt`: IM vectors (32 lines, one bitstring per feature).
- `value_vectors.txt`: CM vectors (`M` lines, one bitstring per level).

### Python scripts (`scripts/`)

- `randomvector.py`: generates random position vectors (currently hard-coded to 32 vectors of length 2000).
- `bitflipvector.py`: generates CM vectors for given `D` and `M` via progressive bit flips.
- `best_result.py`: prints the best row from a results CSV.
- `plots.py`: creates `accuracy vs M` and `accuracy vs D` PNG plots from `results/results.csv`.

### Results (`results/`)

- `results.csv`: sweep output table.
- `plot_accuracy_vs_M.png`, `plot_accuracy_vs_D.png`: current plot outputs.
- `plot_accuracy_vs_*_dataset*.png`: older pre-generated plots.

## Requirements

- C compiler (`gcc`)
- Make (`make` on Linux/macOS, `mingw32-make` on Windows/MinGW)
- Python 3
- Python packages for plotting:
  - `pandas`
  - `matplotlib`

Install Python packages:

```bash
python -m pip install pandas matplotlib
```

## Build and Run

Run commands from the project root (`CModellHDC/` where `Makefile` is located).

### Build

Linux/macOS:

```bash
make build
```

Windows (MinGW):

```bash
mingw32-make build
```

### Run one experiment

Linux/macOS:

```bash
./hdc_model <D> <M> <mode>
```

Windows PowerShell:

```powershell
.\hdc_model.exe <D> <M> <mode>
```

Example:

```bash
./hdc_model 2000 40 0
./hdc_model 2000 40 1
```

```powershell
.\hdc_model.exe 2000 40 0
.\hdc_model.exe 2000 40 1
```

Arguments:

- `D`: hypervector length (bits)
- `M`: number of CM levels
- `mode`: `0` (classic) or `1` (rolling 5-block)

## Analysis and Experiment Scripts

### 1) Full sweep from Makefile (`gen_results`)

Iterates:

- `D`: `1000..10000` (step 1000)
- `M`: `40..100` (step 10)

For each pair, it:

1. Regenerates `memoryfiles/value_vectors.txt` via `scripts/bitflipvector.py D M`
2. Runs `hdc_model` in mode `0` and mode `1`
3. Appends row to `results/results.csv`

Run:

```bash
make gen_results
```

Windows:

```bash
mingw32-make gen_results
```

### 2) Plotting (`scripts/plots.py`)

Generates:

- `results/plot_accuracy_vs_M.png`
- `results/plot_accuracy_vs_D.png`

Run:

```bash
python scripts/plots.py
# or: python3 scripts/plots.py
```

### 3) Best config (`scripts/best_result.py`)

Prints best `D,M,Accuracy` row from a CSV.

Run:

```bash
python scripts/best_result.py results/results.csv
# or: python3 scripts/best_result.py results/results.csv
```

### 4) Memory generation scripts

Generate CM vectors for a chosen run:

```bash
python scripts/bitflipvector.py <D> <M>
# or: python3 scripts/bitflipvector.py <D> <M>
```

Generate position vectors (edit constants inside script if needed):

```bash
python scripts/randomvector.py
# or: python3 scripts/randomvector.py
```

## Common Make Targets

- `build`: compile C program
- `gen_results`: run parameter sweep and write CSV
- `plots`: generate PNG charts
- `best`: print best parameters from CSV
- `run`: `build + gen_results + plots`
- `clean`: remove binary and selected output files

## Notes and Caveats

- `Makefile` currently writes two accuracy values per row (mode 0 and mode 1), while header is `D,M,Accuracy`. If you use the generated CSV for plotting, ensure the schema matches the plotting script expectation.
- `scripts/randomvector.py` is hard-coded for vector size `2000`. If you run with another `D`, regenerate `position-vectors.txt` with matching length first.
- In this environment, `mingw32-make` is available while plain `make` is not in PowerShell.
